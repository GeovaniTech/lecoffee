<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html
	lang="#{MBAppConfigs.appConfigs.language}"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:components="http://java.sun.com/jsf/composite/components"
	xmlns:a="http://xmlns.jcp.org/jsf/passthrough">
	
	<h:body>	
		<ui:composition template="/templates/admin/layout.xhtml">
			<ui:define name="name_page">
				<h:outputText value="#{label.orders}" />
			</ui:define>
			
			<ui:define name="body">
				<script>
			        var scrollPosition = 0;
	
			        function saveScrollPosition() {
			            scrollPosition = document.getElementById('container-orders').scrollTop;
			        }

			        function restoreScrollPosition() {
			            document.getElementById('container-orders').scrollTop = scrollPosition;
			        }
				</script>
				
				<h:outputStylesheet library="css" name="/products/product.css"  />
				<h:outputStylesheet library="css" name="/client/address/address.css" />
				
				<style>
					#menu-pedidos {
						background-color: var(--background-general-mouse);
						color: var(--text-mouse);
					}
					
					#menu-pedidos > * {
						color: var(--text-mouse);
					}
					
					.style {
						padding: 5px 10px;
						border-radius: 30px;
					  	display: inline-block;
					 	width: auto;
					 	font-size: 14px;
					 	color: black;
					}
					
					.container-orders {
						position: fixed;
						height: 100%;
						top: 66px;
						max-width: 400px;
						overflow-y: auto;
						padding-bottom: 65px;
					}
					
					.cardOrder {
						margin-left: 0px;
					}
				</style>
				
				<h:outputStylesheet library="css" name="/simpleCard/simpleCard.css" />
				<h:outputStylesheet library="css" name="/cardOrder/cardOrder.css" />
				
				<div id="scrollTeste">
					<h:form id="formOrders">
						<p:poll 
							interval="10"
							update="@form"
							onstart="saveScrollPosition();"
							oncomplete="updateCards(); restoreScrollPosition(); "/>
					
						<p:remoteCommand 
							name="updateOrdersAdmin"
							onstart="saveScrollPosition();"
							oncomplete="restoreScrollPosition();"
							update="@form" />
						
						<div id="container-orders" class="container-orders">
							<ui:repeat var="order" value="#{MBListOrders.allOrdersAdmin}">
								<components:order 
									orderId="#{order.id}"
									clientName="#{order.client.nome}"
									clientEmail="#{order.client.email}"
									street="#{order.address.street}"
									house_number="#{order.address.house_number}"
									neighborhood="#{order.address.neighborhood}"
									cartId="#{order.cart.id}"
									requestDate="#{order.creationDate}"
									status="#{order.status}"
									paymentName="#{order.payment.name}"
									paymentIcon="#{order.payment.icon}"
									items="#{order.cart.items}"
									renderAdminOptions="true" />
							</ui:repeat>
						</div>
					</h:form>
				</div>
				
				<h:form id="formCardInsights" style="margin-left: 375px;">
					<p:remoteCommand 
						name="updateCards"
						update="@form"/>
				
					<div class="horizontal-evenly">
						<components:simpleCard 
							title="A Confirmar"
							value="#{MBClientOrder.totalAConfirmar}"
							primefacesIcon="pi pi-clock" />
					
						<components:simpleCard 
							title="Em Preparo"
							value="#{MBClientOrder.totalEmPreparo}"
							primefacesIcon="pi pi-spinner" />
						
						<components:simpleCard 
							title="Enviado"
							value="#{MBClientOrder.totalEnviado}"
							primefacesIcon="pi pi-send" />
							
						<components:simpleCard 
							title="Finalizado"
							value="#{MBClientOrder.totalFinalizado}"
							primefacesIcon="pi pi-check-circle" />
						
						<components:simpleCard 
							title="Cancelado"
							value="#{MBClientOrder.totalCancelado}"
							primefacesIcon="pi pi-times-circle" />
					</div>
				</h:form>
				
				<h:form id="messages" style="margin-left: 415px;">
					<p:messages 
						showDetail="false"
						showIcon="false"
		        		autoUpdate="true"  />
				</h:form>
				
				<h:form style="margin-left: 415px;" styleClass="vertical-left">
					<div class="order-top-buttons">
						<p:commandButton 
							icon="pi pi-plus"
							value="#{label.new_order}" 
							action="#{MBClientOrder.initOrder()}"
							update="@form, messages"
							styleClass="mg-r-5" />
						
						<p:commandButton 
							icon="pi pi-times"
							value="#{label.cancel_changes}"
							action="#{MBClientOrder.disableOrder()}"
							update="@form, messages"
							styleClass="deleteStyle"
							disabled="#{!MBClientOrder.startNewOrder}" />
					</div>
					
					<div class="horizontal-left mg-t-10" style="#{MBClientOrder.startNewOrder ? 'display: flex' :  'display:  pointer-events: none; opacity: 0.6;'}">	
						<div class="vertical-left mg-r-10">
							<h2 class="mg-t-10">#{label.client}</h2>
							
							<div class="vertical-left mg-r-5">
								<components:lov 
									mBean="#{MBClientOrder}"
									objectLov="#{MBClientOrder.lovClient}"
									onRowSelect="#{MBClientOrder.onRowSelect()}"
									idField="lovClient"
									valueLabel="#{label.client}"
									toValue="#{MBClientOrder.lovClient.clientSelected}"
									valueInput="#{MBClientOrder.lovClient.clientSelected.email}" />
							</div>
	
							<div class="vertical-left">
								<p:outputLabel 
									value="#{label.delivery_address}"
									for="fieldAddress"/>
								
								<div class='horizontal-left'>
									<p:selectOneMenu
										id="fieldAddress"
										value="#{MBClientOrder.manualOrder.address}"
										converter="simpleEntityConverter"
										style="width: 200px;"
										styleClass="mg-r-5">
										
										<f:selectItem 
											itemLabel="#{label.none}"
											itemValue="#{null}" />
										
										<f:selectItems 
											var="address"
											value="#{MBClientOrder.lovClient.clientSelected.addresses}"
											itemLabel="#{address.street}, #{address.house_number} - #{address.neighborhood}"
											itemValue="#{address}" />
									</p:selectOneMenu>
									
									<p:commandButton 
										icon="pi pi-plus"
										style="height: 39px;" />
								</div>
							</div>
	
							<div class="vertical-left">
								<p:outputLabel 
									value="#{label.payment_method}" />
								
								<p:selectOneMenu 
									value="#{MBClientOrder.manualOrder.payment}"
									converter="simpleEntityConverter"
									style="width: 242.7px;">
									
									<f:selectItems 
										var="payment"
										value="#{MBPayment.payments}"
										itemLabel="#{payment.name}"
										itemValue="#{payment}" />
								</p:selectOneMenu>
							</div>
						</div>
						
						<div class="vertical-left">
							<h2 class="mg-t-10">#{label.cart}</h2>
							
							<p:panelGrid columns="2" width="600px">
								<p>#{label.total_items}</p>
								<p>#{MBClientOrder.totalQuantityOfProdctsFromCart}</p>
								
								<p>#{label.total_order}</p>
								<p>#{MBAppConfigs.getBrazilianCurrency(MBClientOrder.totalOrder)}</p>
							</p:panelGrid>
							
							<p:commandButton 
								id="btnConfirmOrder"
								action="#{MBClientOrder.sendNewOrder}"
								value="#{label.confirm_order}"
								onstart="saveScrollPosition();"
								oncomplete="restoreScrollPosition();"
								update="@form, formCardInsights, formOrders, messages"
								icon="pi pi-check"
								styleClass="mg-t-10"/>
						</div>
					</div>
					<p:remoteCommand 
						name="remoteUpdate"
						update="@form" />
			
					<div class="horizontal-left mg-t-10 mg-b-10" style="#{MBClientOrder.startNewOrder ? 'display: flex' :  'display:  pointer-events: none; opacity: 0.6;'}">
						<h2 class="mg-r-10">#{label.products}</h2>
						<p:commandButton 
							icon="pi pi-filter"
							styleClass="optionsButtonStyle"
							onclick="PF('dialog-filters-products').show();" />
					</div>
					
					<div class="horizontal-evenly" style="width: 100%; #{MBClientOrder.startNewOrder ? 'display: flex' :  'display:  pointer-events: none; opacity: 0.6; '} width: 100%;">
						<ui:repeat var="product" value="#{MBTab_products.products}">
							<components:product 
								name="#{product.name}"
								productId="#{product.id}"
								description="#{product.description}"
								price="#{product.price}"
								imageBytes="#{product.imageBytes}"
								rating="#{product.rating}"
								status="#{product.status}"
								optionsRendered="false"
								addProduct="#{MBClientOrder.addProduct(product.id)}"
								removeProduct="#{MBClientOrder.removeProduct(product.id)}"
								totalQuantityOfProduct="#{MBClientOrder.getQuantityOfProduct(product.id)}"
								update="@form" />
						</ui:repeat>
					</div>
				</h:form>
				
				<ui:include src="/pages/admin/products/dialog_product_filters.xhtml" />
			</ui:define>
		</ui:composition>
	</h:body>
</html>