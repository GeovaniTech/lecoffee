<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html
	lang="#{MBAppConfigs.appConfigs.language}"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:components="http://java.sun.com/jsf/composite/components"
	xmlns:a="http://xmlns.jcp.org/jsf/passthrough">
	
	<h:body>	
		<ui:composition template="/templates/admin/layout.xhtml">
			<ui:define name="name_page">
				<h:outputText value="#{label.orders}" />
			</ui:define>
			
			<ui:define name="body">
				<h:outputStylesheet library="css" name="/products/product.css"  />
				<h:outputStylesheet library="css" name="/client/address/address.css" />
				
				<style>
					#menu-pedidos {
						background-color: var(--background-general-mouse);
						color: var(--text-mouse);
					}
					
					#menu-pedidos > * {
						color: var(--text-mouse);
					}
					
					.style {
						padding: 5px 10px;
						border-radius: 30px;
					  	display: inline-block;
					 	width: auto;
					 	font-size: 14px;
					 	color: black;
					}
					
					.container-orders {
						position: fixed;
						height: 100%;
						top: 66px;
						max-width: 400px;
						overflow-y: auto;
						padding-bottom: 65px;
					}
					
					.cardOrder {
						margin-left: 0px;
					}
				</style>
				
				<h:outputStylesheet library="css" name="/simpleCard/simpleCard.css" />
				<h:outputStylesheet library="css" name="/cardOrder/cardOrder.css" />
				
				<h:form id="formOrders">
					<p:poll 
						interval="10"
						update="@form"
						oncomplete="updateCards();"/>
					
					<p:remoteCommand 
						name="updateOrdersAdmin"
						update="@form" />
					
					<div class="container-orders">
						<ui:repeat var="order" value="#{MBListOrders.allOrdersAdmin}">
							<components:order 
								orderId="#{order.id}"
								clientName="#{order.client.nome}"
								clientEmail="#{order.client.email}"
								street="#{order.address.street}"
								house_number="#{order.address.house_number}"
								neighborhood="#{order.address.neighborhood}"
								cartId="#{order.cart.id}"
								requestDate="#{order.creationDate}"
								status="#{order.status}"
								paymentName="#{order.payment.name}"
								paymentIcon="#{order.payment.icon}"
								items="#{order.cart.items}"
								renderAdminOptions="true" />
						</ui:repeat>
					</div>
				</h:form>
				
				<h:form id="formCardInsights" style="margin-left: 375px;">
					<p:remoteCommand 
						name="updateCards"
						update="@form"/>
				
					<div class="horizontal-evenly">
						<components:simpleCard 
							title="A Confirmar"
							value="#{MBClientOrder.totalAConfirmar}"
							primefacesIcon="pi pi-clock" />
					
						<components:simpleCard 
							title="Em Preparo"
							value="#{MBClientOrder.totalEmPreparo}"
							primefacesIcon="pi pi-spinner" />
						
						<components:simpleCard 
							title="Enviado"
							value="#{MBClientOrder.totalEnviado}"
							primefacesIcon="pi pi-send" />
							
						<components:simpleCard 
							title="Finalizado"
							value="#{MBClientOrder.totalFinalizado}"
							primefacesIcon="pi pi-check-circle" />
						
						<components:simpleCard 
							title="Cancelado"
							value="#{MBClientOrder.totalCancelado}"
							primefacesIcon="pi pi-times-circle" />
					</div>
				</h:form>
				
				<h:form style="margin-left: 415px;" styleClass="vertical-left">
					<div class="order-top-buttons">
						<p:commandButton 
							icon="pi pi-plus"
							value="#{label.new_order}" 
							styleClass="mg-r-5" />
						
						<p:commandButton 
							icon="pi pi-times"
							value="#{label.cancel_changes}"
							styleClass="deleteStyle"
							disabled="true" />
					</div>
					
					<h2 class="mg-t-10">#{label.client}</h2>
					
					<div class="horizontal-left mg-t-10">
						<div class="vertical-left mg-r-5">
							<components:lov 
								mBean="#{MBClientOrder}"
								objectLov="#{MBClientOrder.lovClient}"
								onRowSelect="#{MBClientOrder.onRowSelect()}"
								idField="lovClient"
								valueLabel="#{label.client}"
								toValue="#{MBClientOrder.lovClient.clientSelected}"
								valueInput="#{MBClientOrder.lovClient.clientSelected.email}" />
						</div>
						
						<div class="vertical-left mg-r-5">
							<p:outputLabel 
								value="#{label.delivery_address}" />
							
							<p:commandButton
								icon="pi pi-plus"
								value="#{label.new_address}"
								style="height: 39px;"
								rendered="#{MBClientOrder.lovClient.clientSelected.addresses == null or MBClientOrder.lovClient.clientSelected.addresses.size() == 0 ? true : false}" />
							
							<p:selectOneMenu
								converter="simpleEntityConverter"
								rendered="#{MBClientOrder.lovClient.clientSelected.addresses == null or MBClientOrder.lovClient.clientSelected.addresses.size() == 0 ? false : true}">
								<f:selectItems 
									var="address"
									value="#{MBClientOrder.lovClient.clientSelected.addresses}"
									itemLabel="#{address.street}, #{address.house_number} - #{address.neighborhood}"
									itemValue="#{address}" />
							</p:selectOneMenu>
						</div>
						
						<div class="vertical-left">
							<p:outputLabel 
								value="#{label.payment_method}" />
							
							<p:selectOneMenu 
								converter="simpleEntityConverter"
								style="width: 200px;">
								
								<f:selectItems 
									var="payment"
									value="#{MBPayment.payments}"
									itemLabel="#{payment.name}"
									itemValue="#{payment}" />
							</p:selectOneMenu>
						</div>
					</div>
			
					<h2 class="mg-t-10">#{label.products}</h2>
					
					<p:dataTable 
						widgetVar="tableProducts"
						var="product"
						value="#{MBTab_products.products}"
						selectionMode="single"
						selection="#{MBTab_products.product}"
						rowKey="#{product.id}"
						scrollable="true"
						styleClass="#{MBTab_products.toggleFilter == false ? 'hide-filters' : ''} mg-t-10"
						style="width: 100%;">
									
						<p:column styleClass="toggleFilter">
							<f:facet name="header">
								<p:commandLink
									action="#{MBTab_products.changeToggleFilter()}"
									oncomplete="remoteUpdate();">
									
									<i class="pi pi-filter"></i>
								</p:commandLink>
							</f:facet>
						</p:column>
	
						<p:column headerText="#{label.options}">
							<p:commandButton 
								icon="pi pi-minus" 
								styleClass="optionsButtonStyle mg-r-15" />
								
							<h:outputText value="0" class="mg-r-15" style="font-size: 23px;"/>		
						
							<p:commandButton 
								icon="pi pi-plus" 
								styleClass="optionsButtonStyle" />
					
						</p:column>
						
						<p:column 
							headerText="#{label.name}"
							filterBy="#{product.name}">
							
							<f:facet name="filter">
								<p:inputText>
									<p:ajax 
										event="keyup" 
										delay="500"
										oncomplete="PF('tableProducts').filter()" />
								</p:inputText>
							</f:facet>
							
							<h:outputLabel value="#{product.name}" />
						</p:column>
						
						<p:column 
							headerText="#{label.price}"
							filterBy="#{product.price}">
							
							<f:facet name="filter">
								<p:inputText>
									<p:ajax 
										event="keyup" 
										delay="500"
										oncomplete="PF('tableProducts').filter()" />
								</p:inputText>
							</f:facet>
							
							<h:outputLabel value="#{MBAppConfigs.getBrazilianCurrency(product.price)}" />
						</p:column>
						
						<p:column 
							headerText="#{label.category}"
							filterBy="#{product.category.name}">
							
							<f:facet name="filter">
								<p:selectOneMenu
									style="width: 200px;">
									
									<f:selectItem
										itemLabel="#{label.none}"
										itemValue="" />
									
									<f:selectItems 
										var="category"
										value="#{MBTab_category.categories}"
										itemLabel="#{category.name}"
										itemValue="#{category.name}" />
										
									<p:ajax 
										event="valueChange" 
										oncomplete="PF('tableProducts').filter()" />
								</p:selectOneMenu>
							</f:facet>
							
							<h:outputLabel value="#{product.category.name}" />
						</p:column>
						
						<p:column 
							headerText="#{label.status}"
							filterBy="#{product.status}">
							
							<f:facet name="filter">
								<p:selectOneMenu
									style="width: 200px;">
									
									<f:selectItem
										itemLabel="#{label.none}"
										itemValue="" />
									
									<f:selectItem
										itemLabel="#{label.active}"
										itemValue="active" />
									
									<f:selectItem 
										itemLabel="#{label.disabled}"
										itemValue="disabled"/>
									
									<p:ajax 
										event="valueChange" 
										oncomplete="PF('tableProducts').filter()" />
								</p:selectOneMenu>
							</f:facet>
							
							<h:outputLabel value="#{product.status eq 'active' ? label.active : label.disabled}" />
						</p:column>
						
						<p:column 
							headerText="#{label.rating}"
							filterBy="#{product.rating}">
							
							<f:facet name="filter">
								<p:inputText>
									<p:ajax 
										event="keyup" 
										delay="500"
										oncomplete="PF('tableProducts').filter()" />
								</p:inputText>
							</f:facet>
							
							<h:outputLabel value="#{product.rating}" />
						</p:column>
						
						<p:column 
							headerText="#{label.creation_date}"
							filterBy="#{product.creationDate}">
							
							<f:facet name="filter">
								<p:datePicker pattern="dd/MM/yyyy">
									<p:ajax 
										event="valueChange" 
										oncomplete="PF('tableProducts').filter()" />
									
									<p:ajax 
										delay="500"
										event="keyup" 
										oncomplete="PF('tableProducts').filter()" />
								</p:datePicker>
							</f:facet>
							
							<h:outputText value="#{product.creationDate.time}">
								<f:convertDateTime pattern="dd/MM/yyyy HH:mm:ss" />
							</h:outputText>
						</p:column>
					</p:dataTable>

				</h:form>
			</ui:define>
		</ui:composition>
	</h:body>
</html>