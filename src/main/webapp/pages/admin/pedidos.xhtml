<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html
	lang="#{MBAppConfigs.appConfigs.language}"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:components="http://java.sun.com/jsf/composite/components"
	xmlns:a="http://xmlns.jcp.org/jsf/passthrough">
	
	<h:body>
		<ui:composition template="/templates/admin/layout.xhtml">
			<ui:define name="name_page">
				<h:outputText value="#{label.orders}" />
			</ui:define>
			
			<ui:define name="body">
				<style>
					#menu-pedidos {
						background-color: var(--background-general-mouse);
						color: var(--text-mouse);
					}
					
					#menu-pedidos > * {
						color: var(--text-mouse);
					}
					
					.style {
						padding: 5px 10px;
						border-radius: 30px;
					  	display: inline-block;
					 	width: auto;
					 	font-size: 14px;
					 	color: black;
					}
				</style>
				

				
				<h:form id="formTableOrders">
					<p:poll 
						id="orderPoll"
						interval="10"
						listener="#{MBClientOrder.list()}"
						update="@form" />
				
					<p:dataTable
						id="tableOrders"
						widgetVar="tableOrders"
						var="order"
						value="#{MBClientOrder.orders}"
						rowKey="#{order.id}"
						scrollable="true"
						styleClass="#{MBTab_products.toggleFilter == false ? 'hide-filters' : ''}">
						
						 <p:ajax 
						 	event="rowSelect" 
						 	oncomplete="openDialogChange()" />
						
			            <p:column style="width:2rem">
			                <p:rowToggler/>
			            </p:column>
						
						<p:column styleClass="toggleFilter">
							<f:facet name="header">
								<p:commandLink
									action="#{MBTab_products.changeToggleFilter()}"
									oncomplete="remoteUpdate();">
									
									<i class="pi pi-filter"></i>
								</p:commandLink>
							</f:facet>
						</p:column>
						
						<p:column headerText="#{label.client}">
							<h:outputText value="#{order.client.nome eq '' or order.client.nome == null ? order.client.email : order.client.nome}" />
						</p:column>
						
						<p:column headerText="#{label.delivery_address}">
							<h:outputText value="#{order.address.street}, #{order.address.house_number}" />
							<br />
							<h:outputText value="#{order.address.neighborhood}" />
						</p:column>
						
						<p:column headerText="Total">
							<h:outputText value="#{MBAppConfigs.getBrazilianCurrency(MBClientOrder.getTotalOrder(order.cart.id))}" />
						</p:column>
						
						<p:column headerText="Payment">
							<h:outputText value="#{order.payment.name}" />
						</p:column>
						
						<p:column headerText="Status">
							<div class="style vertical-center" style="background-color: #{order.status eq 'A confirmar' ? '#ffcc00' : order.status eq 'Finalizado' ? '#339900' : order.status eq 'Cancelado' ? '#cc3300' : order.status eq 'Em preparo' ? '#00bcd4' : order.status eq 'Enviado' ? '#ed4981;' :''}">
								<h:outputText value="#{order.status}" />
							</div>
						</p:column>
						
						<p:rowExpansion>
							<h3 class="mg-b-10">#{label.products}</h3>
							<ui:repeat var="item" value="#{order.cart.items}">
								<div class="horizontal-left-center mg-b-10">
									<h:graphicImage value="data:image/png;base64,#{MBAppConfigs.getRenderedImage(item.product.imageBytes)}" class="mg-r-10" style="width: 50px; height: 50px; border-radius: 10px;"/>
									<h:outputText value="#{item.amount}un" style="margin-right: 10px;" />
									<h:outputText value="#{item.product.name}" />
								</div>
							</ui:repeat>
							
							<p:toolbar>
								<f:facet name="left">
									<p:commandButton 
										icon="pi pi-check-circle"
										value="#{label.accept}"
										action="#{MBClientOrder.acceptOrder(order.id)}"
										styleClass="mg-r-5"
										update="@form"
										rendered="#{order.status eq 'A confirmar' ? true : false}" />

									<p:commandButton 
										icon="pi pi-send"
										value="#{label.send}"
										action="#{MBClientOrder.sendOrder(order.id)}"
										update="@form"
										styleClass="mg-r-5"
										rendered="#{order.status eq 'Em preparo'}" />
										
									<p:commandButton 
										icon="pi pi-check-square"
										value="#{label.finish}"
										action="#{MBClientOrder.finishOrder(order.id)}"
										update="@form"
										styleClass="mg-r-5"
										rendered="#{order.status eq 'Enviado'}" />
								
									<p:commandButton 
										icon="pi pi-trash"
										value="#{label.cancel}"
										action="#{MBClientOrder.cancelOrder(order.id)}"
										styleClass="deleteStyle mg-r-5"
										update="@form"
										rendered="#{order.status != 'Finalizado' and order.status != 'Cancelado' ? true : false}" />
								</f:facet>
							</p:toolbar>
						</p:rowExpansion>
					</p:dataTable>
				</h:form>
			</ui:define>
		</ui:composition>
	</h:body>
</html>